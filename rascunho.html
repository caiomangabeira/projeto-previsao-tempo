async function obterCoordenadas(cidade) {
    const urlcoor = `https://www.meteoblue.com/en/server/search/query3?query=${cidade}&apikey=pXE7KGPmH1ieW5MU`;

    try {
        const responsecoor = await fetch(urlcoor);

        if (!responsecoor.ok) {
            console.log('Erro de resposta do servidor:', responsecoor.statusText);
            return null;
        }

        const dados = await responsecoor.json();
        console.log('Dados das coordenadas:', dados);

        const resultados = dados.results;

        if (resultados && resultados.length > 0) {
            return resultados[0];
        } else {
            console.log('Nenhum resultado encontrado.');
            return null;
        }

        const coordenadas = await responsecoor.json();

        console.log(coordenadas)
        return coordenadas;

    } catch(err) {
        console.log('Erro na requisição:', err)
        return null;
    }
}

const botao = document.getElementById('botaobuscar');

const itxtcidade = document.getElementById('itxtcidade');

const divcf = document.getElementsByClassName('divcf');

async function obterCoordenadas(cidade) {
    const urlcoor = `https://www.meteoblue.com/en/server/search/query3?query=${cidade}&apikey=pXE7KGPmH1ieW5MU`;

    try {
        const responsecoor = await fetch(urlcoor);

        if (!responsecoor.ok) {
            console.log('Erro de resposta do servidor:', responsecoor.statusText);
            return null;
        }

        const dados = await responsecoor.json();
        console.log('Dados das coordenadas:', dados);

        // Verifique a estrutura dos dados e ajuste conforme necessário
        const resultados = dados.results;
        if (resultados && resultados.length > 0) {
            // Retorne o primeiro resultado ou escolha o mais apropriado
            return resultados[0];
        } else {
            console.log('Nenhum resultado encontrado.');
            return null;
        }
    } catch(err) {
        console.log('Erro na requisição:', err);
        return null;
    }
}

async function obterMeteorologia(coordenadas) {

    if (!coordenadas || !coordenadas.lat || !coordenadas.lon) {
     console.log('Coordenadas não disponíveis ou inválidas.') 
     return null;
    } 
    
    const { lat, lon } = coordenadas;

    const url = `https://my.meteoblue.com/packages/basic-1h_basic-day?apikey=pXE7KGPmH1ieW5MU&lat=${lat}&lon=${lon}&format=json`;

    try {
        const response = await fetch(url);

        if (!response.ok) {
            console.log('Erro de resposta do servidor:', response.statusText);
            return null;
        }

        const data = await response.json();
        console.log('Dados da meteorologia da cidade fornecida:', data);
        return data;

    } catch(err) {
        console.log('Erro na requisição:', err)
        return null;
    }
}

function exibircidadefornecida(dados) {
    divcf.innerHTML = '';
    divcf.style.backgroundColor = 'white';
    if (dados && dados.weather) {
        const { weather } = dados;

        const divcf = document.createElement('div');
        divcf.innerHTML = `
            <h2>Previsão Meteorológica</h2>
            <p>Temperatura: ${weather.temperature} °C</p>
            <p>Condição: ${weather.condition}</p>
        `;
    } else {
        divcf.innerHTML = '<p>Nenhum dado meteorológico disponível.</p>';
    }
}

botao.addEventListener("click", async () => {
    const valorCidade = itxtcidade.value;
    const coordenadas = await obterCoordenadas(valorCidade);

    if (coordenadas) {
        const dados = await obterMeteorologia(coordenadas);
        exibircidadefornecida(dados);
    } else {
        divcf.innerHTML = '<p>Não foi possível obter coordenadas para a cidade fornecida.</p>';
    }
});